{"parsed":{"_path":"/pyshics-test","_dir":"","_draft":false,"_partial":false,"_locale":"","title":"Simple physics simulation using Box2D","description":"Box2D + SDL2 + GLUT + OpenGL","recommended":true,"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"What we're making:"}]},{"type":"element","tag":"img","props":{"src":"/img/test.gif","alt":"self portrait","width":500},"children":[]},{"type":"element","tag":"pre","props":{"className":["language-C++"],"code":"#include <iostream>\n#include <SDL2/SDL.h>\n#include <SDL2/SDL_image.h>\n#include <GL/gl.h>\n#include <GL/glu.h>\n#include \"./box2d/include/box2d/box2d.h\"\n\nconst int WIDTH=640;\nconst int HEIGHT=480;\nconst float M2P=20;\nconst float P2M=1/M2P;\nb2World* world;\n\nb2Body* addRect(int x,int y,int w,int h,bool dyn=true)\n{\n   b2BodyDef bodydef;\n   bodydef.position.Set(x*P2M,y*P2M);\n   if(dyn)\n      bodydef.type=b2_dynamicBody;\n   b2Body* body=world->CreateBody(&bodydef);\n    \n   b2PolygonShape shape;\n   shape.SetAsBox(P2M*w/2,P2M*h/2);\n   \n   b2FixtureDef fixturedef;\n   fixturedef.shape=&shape;\n   fixturedef.density=1.0;\n   body->CreateFixture(&fixturedef);\n}\n\nvoid drawSquare(b2Vec2* points,b2Vec2 center,float angle)\n{\n    glColor3f(1,1,1);\n    glPushMatrix();\n        glTranslatef(center.x*M2P,center.y*M2P,0);\n        glRotatef(angle*180.0/M_PI,0,0,1);\n        glBegin(GL_QUADS);\n            for(int i=0;i<4;i++)\n                glVertex2f(points[i].x*M2P,points[i].y*M2P);\n        glEnd();\n    glPopMatrix();\n}\n\nvoid init()\n{\n    glMatrixMode(GL_PROJECTION);\n        glOrtho(0,WIDTH,HEIGHT,0,-1,1);\n    glMatrixMode(GL_MODELVIEW);\n    glClearColor(0,0,0,1);\n    world=new b2World(b2Vec2(0.0,9.81));\n    addRect(WIDTH/2,HEIGHT-50,WIDTH,30,false);\n}\n\nvoid display()\n{\n   glClear(GL_COLOR_BUFFER_BIT);\n   glLoadIdentity();\n   b2Body* tmp=world->GetBodyList();\n   b2Vec2 points[4];\n   while(tmp)\n   {\n      for(int i=0;i<4;i++)\n         points[i]=((b2PolygonShape*)tmp->GetFixtureList()->GetShape())->m_vertices[i];\n      drawSquare(points,tmp->GetWorldCenter(),tmp->GetAngle());\n      tmp=tmp->GetNext();\n   }\n}\n\nint main(int argc,char** argv)\n{\n    SDL_Init(SDL_INIT_EVERYTHING);\n    //SDL_SetVideoMode(640,480,32,SDL_OPENGL);\n    SDL_Window *window = SDL_CreateWindow(\"My window\",0,0,640,480,SDL_WINDOW_OPENGL);\n    SDL_GLContext glcontext = SDL_GL_CreateContext(window);\n    Uint32 start;\n    SDL_Event event;\n    bool running=true;\n    init();\n    while(running)\n    {\n        start=SDL_GetTicks();\n        while(SDL_PollEvent(&event))\n        {\n            switch(event.type)\n            {\n                case SDL_QUIT:\n                    running=false;\n                    break;\n                case SDL_KEYDOWN:\n                    switch(event.key.keysym.sym)\n                    {\n                        case SDLK_ESCAPE:\n                            running=false;\n                            break;\n                    }\n                    break;\n                case SDL_MOUSEBUTTONDOWN:\n                    addRect(event.button.x,event.button.y,20,20,true);\n                    break;\n            }\n        }\n        display();\n        world->Step(1.0/30.0,8,3);  //update\n        SDL_GL_SwapWindow(window);\n        if(1000.0/30>SDL_GetTicks()-start)\n            SDL_Delay(1000.0/30-(SDL_GetTicks()-start));\n    }\n    SDL_Quit();\n}\n","language":"C++","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"#include <iostream>\n#include <SDL2/SDL.h>\n#include <SDL2/SDL_image.h>\n#include <GL/gl.h>\n#include <GL/glu.h>\n#include \"./box2d/include/box2d/box2d.h\"\n\nconst int WIDTH=640;\nconst int HEIGHT=480;\nconst float M2P=20;\nconst float P2M=1/M2P;\nb2World* world;\n\nb2Body* addRect(int x,int y,int w,int h,bool dyn=true)\n{\n   b2BodyDef bodydef;\n   bodydef.position.Set(x*P2M,y*P2M);\n   if(dyn)\n      bodydef.type=b2_dynamicBody;\n   b2Body* body=world->CreateBody(&bodydef);\n    \n   b2PolygonShape shape;\n   shape.SetAsBox(P2M*w/2,P2M*h/2);\n   \n   b2FixtureDef fixturedef;\n   fixturedef.shape=&shape;\n   fixturedef.density=1.0;\n   body->CreateFixture(&fixturedef);\n}\n\nvoid drawSquare(b2Vec2* points,b2Vec2 center,float angle)\n{\n    glColor3f(1,1,1);\n    glPushMatrix();\n        glTranslatef(center.x*M2P,center.y*M2P,0);\n        glRotatef(angle*180.0/M_PI,0,0,1);\n        glBegin(GL_QUADS);\n            for(int i=0;i<4;i++)\n                glVertex2f(points[i].x*M2P,points[i].y*M2P);\n        glEnd();\n    glPopMatrix();\n}\n\nvoid init()\n{\n    glMatrixMode(GL_PROJECTION);\n        glOrtho(0,WIDTH,HEIGHT,0,-1,1);\n    glMatrixMode(GL_MODELVIEW);\n    glClearColor(0,0,0,1);\n    world=new b2World(b2Vec2(0.0,9.81));\n    addRect(WIDTH/2,HEIGHT-50,WIDTH,30,false);\n}\n\nvoid display()\n{\n   glClear(GL_COLOR_BUFFER_BIT);\n   glLoadIdentity();\n   b2Body* tmp=world->GetBodyList();\n   b2Vec2 points[4];\n   while(tmp)\n   {\n      for(int i=0;i<4;i++)\n         points[i]=((b2PolygonShape*)tmp->GetFixtureList()->GetShape())->m_vertices[i];\n      drawSquare(points,tmp->GetWorldCenter(),tmp->GetAngle());\n      tmp=tmp->GetNext();\n   }\n}\n\nint main(int argc,char** argv)\n{\n    SDL_Init(SDL_INIT_EVERYTHING);\n    //SDL_SetVideoMode(640,480,32,SDL_OPENGL);\n    SDL_Window *window = SDL_CreateWindow(\"My window\",0,0,640,480,SDL_WINDOW_OPENGL);\n    SDL_GLContext glcontext = SDL_GL_CreateContext(window);\n    Uint32 start;\n    SDL_Event event;\n    bool running=true;\n    init();\n    while(running)\n    {\n        start=SDL_GetTicks();\n        while(SDL_PollEvent(&event))\n        {\n            switch(event.type)\n            {\n                case SDL_QUIT:\n                    running=false;\n                    break;\n                case SDL_KEYDOWN:\n                    switch(event.key.keysym.sym)\n                    {\n                        case SDLK_ESCAPE:\n                            running=false;\n                            break;\n                    }\n                    break;\n                case SDL_MOUSEBUTTONDOWN:\n                    addRect(event.button.x,event.button.y,20,20,true);\n                    break;\n            }\n        }\n        display();\n        world->Step(1.0/30.0,8,3);  //update\n        SDL_GL_SwapWindow(window);\n        if(1000.0/30>SDL_GetTicks()-start)\n            SDL_Delay(1000.0/30-(SDL_GetTicks()-start));\n    }\n    SDL_Quit();\n}\n"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:pyshics-test.md","_source":"content","_file":"pyshics-test.md","_extension":"md"},"hash":"9BQTak9E1M"}